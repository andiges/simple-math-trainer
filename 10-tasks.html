<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mixed Math Trainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: #f7fafc;
      font-family: 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 2rem 0;
    }
    .container {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
      padding: 2rem 2.5rem;
      text-align: center;
      max-width: 600px;
      width: 100%;
    }
    h1 {
      color: #276749;
      margin-bottom: 0.6rem;
      font-size: 2rem;
    }
    .task-list {
      display: grid;
      grid-template-columns: 
        minmax(38px,auto) 1fr 66px 60px
        minmax(38px,auto) 1fr 66px 60px;
      gap: 0.6em 0.3em;
      margin: 1.2rem 0 2rem 0;
      align-items: center;
    }
    .task-number {
      font-family: 'Roboto Mono', 'Menlo', 'Consolas', monospace;
      font-size: 1.11em;
      font-weight: 700;
      color: #2b6cb0;
      justify-self: right;
      padding-right: 0.35em;
    }
    .task-question {
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 1.13em;
      color: #333;
      text-align: left;
      font-weight: 500;
    }
    .task-answer {
      justify-self: center;
    }
    input[type="number"].answer-field {
      font-size: 1.13rem;
      width: 58px;
      margin: 0;
      padding: 0.19rem 0.31rem;
      border-radius: 6px;
      border: 1px solid #b2f5ea;
      outline: none;
      text-align: center;
      transition: border 0.2s;
      background: #fff;
      box-sizing: border-box;
    }
    input[type="number"].answer-field:focus {
      border: 1.5px solid #319795;
    }
    .result {
      font-size: 1.16rem;
      min-width: 3.5em;
      text-align: left;
      display: inline-block;
      padding-left: 0.1em;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-weight: bold;
      vertical-align: middle;
      white-space: nowrap;
    }
    .task-row-correct .answer-field {
      background: #c6f6d5;
      border-color: #38a169;
    }
    .task-row-wrong .answer-field {
      background: #fed7d7;
      border-color: #e53e3e;
    }
    .task-row-correct .result {
      color: #38a169;
    }
    .task-row-wrong .result {
      color: #e53e3e;
    }
    .actions {
      display: flex;
      justify-content: center;
      gap: 1.3rem;
      margin-top: 1.1rem;
    }
    button {
      margin-top: 0.3rem;
      font-size: 1.08rem;
      padding: 0.5rem 1.3rem;
      background: #38b2ac;
      color: #fff;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #319795;
    }
    .statistics {
      margin-top: 2rem;
      font-size: 1.08rem;
      color: #4a5568;
      background: #ebf8ff;
      border-radius: 8px;
      padding: 1rem 0.5rem 0.8rem 0.5rem;
      text-align: left;
      display: inline-block;
      min-width: 220px;
    }
    .statistics span {
      display: block;
      margin: 0.2rem 0;
    }
    .statistics .sets-span {
      font-weight: bold;
      margin-top: 0.5em;
      color: #2b6cb0;
      font-size: 1.09em;
    }
    @media (max-width: 900px) {
      .container { max-width: 98vw; padding: 1.3rem 0.5rem 1.5rem 0.5rem;}
      .task-list {
        grid-template-columns: 
          minmax(38px,auto) 1fr 50px 46px
          minmax(38px,auto) 1fr 50px 46px;
        gap: 0.4em 0.15em;
      }
      input[type="number"].answer-field { width: 46px; }
      .result { min-width: 2.6em; }
    }
    @media (max-width: 600px) {
      .task-list {
        grid-template-columns: minmax(38px,auto) 1fr 66px 60px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mixed Math Trainer</h1>
    <div id="taskList" class="task-list"></div>
    <div class="actions">
      <button id="checkBtn">Check Answers</button>
      <button id="retryBtn">New Set</button>
    </div>
    <div id="statistics" class="statistics"></div>
  </div>
  <script>
    // Cumulative statistics over multiple sets:
    const cumulativeStats = {
      addition: { correct: 0, total: 0 },
      subtraction: { correct: 0, total: 0 },
      multiplication: { correct: 0, total: 0 },
      division: { correct: 0, total: 0 }
    };
    let totalSets = 0;
    let checkedThisSet = false;

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function generateTask() {
      const ops = ['addition', 'subtraction', 'multiplication', 'division'];
      const op = ops[getRandomInt(0, 3)];
      let a, b, question, answer, symbol;

      switch(op) {
        case 'addition':
          a = getRandomInt(1, 99);
          b = getRandomInt(1, 99 - a);
          question = `${a} + ${b}`;
          answer = a + b;
          symbol = '+';
          break;
        case 'subtraction':
          a = getRandomInt(2, 99);
          b = getRandomInt(1, a-1);
          question = `${a} − ${b}`;
          answer = a - b;
          symbol = '−';
          break;
        case 'multiplication':
          a = getRandomInt(1, 10);
          b = getRandomInt(1, 10);
          question = `${a} × ${b}`;
          answer = a * b;
          symbol = '×';
          break;
        case 'division':
          b = getRandomInt(2, 10);
          answer = getRandomInt(1, 10);
          a = b * answer;
          question = `${a} ÷ ${b}`;
          symbol = '÷';
          break;
      }
      return { op, question, answer, symbol };
    }

    let tasks = [];
    function generateTasks() {
      tasks = [];
      for(let i=0; i<10; i++) {
        tasks.push(generateTask());
      }
    }

    function renderTasks() {
      const list = document.getElementById('taskList');
      list.innerHTML = '';
      for (let row = 0; row < 5; row++) {
        // Left column
        let idx = row;
        list.appendChild(taskGridRow(idx));
        // Right column
        idx = row + 5;
        if (idx < tasks.length) list.appendChild(taskGridRow(idx));
      }
    }

    function taskGridRow(idx) {
      const task = tasks[idx];
      // Task number
      const number = document.createElement('span');
      number.className = 'task-number';
      number.textContent = `${idx+1}.`;

      // Task question
      const question = document.createElement('span');
      question.className = 'task-question';
      question.textContent = task.question + ' =';

      // Answer input
      const answer = document.createElement('input');
      answer.type = 'number';
      answer.className = 'answer-field';
      answer.id = `answer-${idx}`;
      answer.setAttribute('data-idx', idx);
      answer.setAttribute('autocomplete', 'off');

      // Result field
      const result = document.createElement('span');
      result.className = 'result';
      result.id = `result-${idx}`;

      // Wrap everything in a fragment to insert into grid cell order
      const fragment = document.createDocumentFragment();
      fragment.appendChild(number);
      fragment.appendChild(question);
      fragment.appendChild(answer);
      fragment.appendChild(result);
      return fragment;
    }

    function showStatistics(stats) {
      document.getElementById('statistics').innerHTML = `
        <span>Addition: ${stats.addition.correct}/${stats.addition.total}</span>
        <span>Subtraction: ${stats.subtraction.correct}/${stats.subtraction.total}</span>
        <span>Multiplication: ${stats.multiplication.correct}/${stats.multiplication.total}</span>
        <span>Division: ${stats.division.correct}/${stats.division.total}</span>
        <span class="sets-span">Sets: ${totalSets}</span>
      `;
    }

    function checkAllAnswers(force) {
      if (checkedThisSet && !force) return; // Prevent double-counting
      checkedThisSet = true;

      document.getElementById('checkBtn').disabled = true;
      document.querySelectorAll('.answer-field').forEach(input => input.disabled = true);

      // Stats for this set:
      const stats = {
        addition: { correct: 0, total: 0 },
        subtraction: { correct: 0, total: 0 },
        multiplication: { correct: 0, total: 0 },
        division: { correct: 0, total: 0 }
      };

      let allEmpty = true;
      for(let idx=0; idx<tasks.length; idx++) {
        const input = document.getElementById(`answer-${idx}`);
        if (input.value.trim() !== '') {
          allEmpty = false;
          break;
        }
      }

      totalSets++;

      if (allEmpty) {
        // Mark as failed: only increment totals, not corrects
        const opCounts = { addition: 0, subtraction: 0, multiplication: 0, division: 0 };
        for (const task of tasks) opCounts[task.op]++;
        for (const op in opCounts) {
          if (opCounts[op] > 0) {
            cumulativeStats[op].total += opCounts[op];
          }
        }
        // Mark all result fields with a "failed set" icon
        for(let idx=0; idx<tasks.length; idx++) {
          const input = document.getElementById(`answer-${idx}`);
          const resultSpan = document.getElementById(`result-${idx}`);
          input.classList.remove('task-row-correct', 'task-row-wrong');
          input.parentElement.classList.remove('task-row-correct', 'task-row-wrong');
          resultSpan.textContent = '❌';
        }
      } else {
        // Normal check
        for(let idx=0; idx<tasks.length; idx++) {
          const task = tasks[idx];
          const input = document.getElementById(`answer-${idx}`);
          const resultSpan = document.getElementById(`result-${idx}`);
          const userVal = parseInt(input.value, 10);

          stats[task.op].total++;
          cumulativeStats[task.op].total++;

          input.classList.remove('task-row-correct', 'task-row-wrong');
          input.parentElement.classList.remove('task-row-correct', 'task-row-wrong');

          if (userVal === task.answer) {
            input.classList.add('task-row-correct');
            input.parentElement.classList.add('task-row-correct');
            resultSpan.textContent = '✅';
            stats[task.op].correct++;
            cumulativeStats[task.op].correct++;
          } else {
            input.classList.add('task-row-wrong');
            input.parentElement.classList.add('task-row-wrong');
            resultSpan.textContent = userVal === userVal /*not NaN*/ ? `❌ (${task.answer})` : '';
          }
        }
      }
      showStatistics(cumulativeStats);
    }

    function enableInputs() {
      document.getElementById('checkBtn').disabled = false;
      document.querySelectorAll('.answer-field').forEach(input => {
        input.disabled = false;
        input.value = '';
        input.classList.remove('task-row-correct', 'task-row-wrong');
        input.parentElement.classList.remove('task-row-correct', 'task-row-wrong');
      });
      document.querySelectorAll('.result').forEach(span => span.textContent = '');
      checkedThisSet = false;
    }

    function startNew() {
      // If current set hasn't been checked, do so before starting a new set
      if (!checkedThisSet) {
        checkAllAnswers(true);
      }
      generateTasks();
      renderTasks();
      enableInputs();
      showStatistics(cumulativeStats);
      setTimeout(() => {
        const first = document.getElementById('answer-0');
        if (first) first.focus();
      }, 80);
    }

    document.getElementById('checkBtn').onclick = function() { checkAllAnswers(false); };
    document.getElementById('retryBtn').onclick = startNew;

    document.getElementById('taskList').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const idx = parseInt(e.target.getAttribute('data-idx'), 10);
        if (idx < 9) {
          document.getElementById(`answer-${idx+1}`).focus();
        } else {
          document.getElementById('checkBtn').focus();
        }
      }
    });

    startNew();
  </script>
</body>
</html>